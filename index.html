<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Slot Pick System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .header h1 {
            color: #5865F2;
            margin-bottom: 10px;
        }

        .discord-setup {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #5865F2;
        }

        .discord-setup h3 {
            color: #5865F2;
            margin-bottom: 15px;
        }

        .setup-steps {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 3px solid #5865F2;
        }

        .step-number {
            background: #5865F2;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            flex-shrink: 0;
        }

        .discord-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: #5865F2;
            color: white;
        }

        .btn-success {
            background: #57F287;
            color: black;
        }

        .btn-danger {
            background: #ED4245;
            color: white;
        }

        .btn-warning {
            background: #FEE75C;
            color: black;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .admin-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #dc3545;
        }

        .admin-panel h2 {
            color: #dc3545;
            margin-bottom: 15px;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .status-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .status-item {
            padding: 10px;
            background: white;
            border-radius: 8px;
            text-align: center;
        }

        .map-container {
            margin-bottom: 30px;
        }

        .map-container h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .map {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 400px;
        }

        .slot {
            background: white;
            border: 3px solid #667eea;
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .slot.occupied {
            border-color: #57F287;
            background: #f8fff9;
        }

        .slot-number {
            position: absolute;
            top: -10px;
            left: -10px;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .slot.occupied .slot-number {
            background: #57F287;
        }

        .slot-username {
            font-weight: bold;
            color: #333;
            word-break: break-word;
            margin-top: 5px;
        }

        .participants-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .participants-list h3 {
            margin-bottom: 15px;
            color: #333;
        }

        #participantsQueue {
            list-style-position: inside;
        }

        #participantsQueue li {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: #57F287;
        }

        .notification.error {
            background: #ED4245;
        }

        .notification.info {
            background: #5865F2;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .discord-message-preview {
            background: #2C2F33;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        .discord-reactions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .discord-reaction {
            background: #40444B;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .discord-reaction:hover {
            background: #4F545C;
        }

        input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            min-width: 200px;
        }

        .test-section {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #f8f8f2;
            min-height: 400px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .map {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .admin-controls, .discord-controls {
                flex-direction: column;
            }
            
            .status-panel {
                grid-template-columns: 1fr;
            }
            
            input {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Discord Slot Pick System</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–∏ –≤ —Å–ª–æ—Ç—ã —á–µ—Ä–µ–∑ Discord —Ä–µ–∞–∫—Ü–∏–∏ ‚úÖ</p>
        </div>

        <!-- Discord Setup -->
        <div class="discord-setup">
            <h3>üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Discord</h3>
            
            <div class="setup-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div>
                        <strong>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –±–æ—Ç–∞ –Ω–∏–∂–µ</strong>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª <code>bot.js</code> –Ω–∞ —Å–≤–æ–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">2</div>
                    <div>
                        <strong>–ó–∞–º–µ–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ ID –∫–∞–Ω–∞–ª–∞</strong>
                        <p>–í –∫–æ–¥–µ –±–æ—Ç–∞ –∑–∞–º–µ–Ω–∏—Ç–µ <code>YOUR_BOT_TOKEN</code> –∏ <code>YOUR_CHANNEL_ID</code></p>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">3</div>
                    <div>
                        <strong>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞</strong>
                        <p>–í –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ: <code>node bot.js</code></p>
                    </div>
                </div>
            </div>

            <div class="discord-controls">
                <button class="btn btn-success" onclick="showBotCode()">ü§ñ –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥ –±–æ—Ç–∞</button>
                <button class="btn btn-primary" onclick="testManualAdd()">üß™ –¢–µ—Å—Ç: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            </div>

            <div class="discord-message-preview">
                <strong>üìù –°–æ–æ–±—â–µ–Ω–∏–µ –≤ Discord:</strong>
                <p>üéØ <strong>–°–ò–°–¢–ï–ú–ê –ó–ê–ü–ò–°–ò –í –°–õ–û–¢–´</strong></p>
                <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ä–µ–∞–∫—Ü–∏—é ‚úÖ —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –æ—á–µ—Ä–µ–¥—å</p>
                <div class="discord-reactions">
                    <span class="discord-reaction">‚úÖ</span> - –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
                </div>
                <p><em>–°–ª–æ—Ç—ã –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É –Ω–∞–∂–∞—Ç–∏—è</em></p>
            </div>
        </div>

        <!-- Bot Code Section -->
        <div id="botCodeSection" style="display: none; background: #2b2b2b; color: #f8f8f2; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3>ü§ñ –ö–æ–¥ –¥–ª—è Discord –±–æ—Ç–∞</h3>
            <textarea id="botCode" readonly></textarea>
            <div class="discord-controls">
                <button class="btn btn-success" onclick="copyBotCode()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
                <button class="btn btn-primary" onclick="downloadBotCode()">üíæ –°–∫–∞—á–∞—Ç—å bot.js</button>
            </div>
        </div>

        <!-- Admin Panel -->
        <div class="admin-panel">
            <h2>‚öôÔ∏è –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
            <div class="admin-controls">
                <button class="btn btn-success" onclick="togglePicking(true)">‚úÖ –í–∫–ª—é—á–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                <button class="btn btn-danger" onclick="togglePicking(false)">‚ùå –í—ã–∫–ª—é—á–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                <button class="btn btn-warning" onclick="resetPicks()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –æ—á–µ—Ä–µ–¥—å</button>
                <button class="btn btn-primary" onclick="exportData()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            </div>
            
            <div class="status-panel">
    <div class="status-item">
        <strong>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:</strong>
        <div id="systemStatus">‚úÖ –í–∫–ª—é—á–µ–Ω–∞</div>
    </div>
    <div class="status-item">
        <strong>–í –æ—á–µ—Ä–µ–¥–∏:</strong>
        <div id="totalPicks">0/17</div>
    </div>
    <div class="status-item">
        <strong>WebSocket:</strong>
        <div id="websocketStatus">üî¥ –û—Ç–∫–ª—é—á–µ–Ω</div>
    </div>
    <div class="status-item">
        <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ:</strong>
        <div id="lastAction">-</div>
    </div>
</div>
        </div>

        <!-- Map -->
        <div class="map-container">
            <h2>üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Å–ª–æ—Ç–æ–≤</h2>
            <div class="map" id="map">
                <!-- –°–ª–æ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>

        <!-- Participants List -->
        <div class="participants-list">
            <h3>üìã –û—á–µ—Ä–µ–¥—å –∑–∞–ø–∏—Å–∏</h3>
            <ol id="participantsQueue">
                <li>–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞</li>
            </ol>
        </div>

        <!-- Test Section -->
        <div class="test-section">
            <h3>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –±–µ–∑ Discord –±–æ—Ç–∞:</p>
            <div class="discord-controls">
                <input type="text" id="testUsername" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" value="akkawfdkosdiwkekdsiskfas">
                <button class="btn btn-success" onclick="addUserManual()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å</button>
                <button class="btn btn-danger" onclick="removeUserManual()">‚ùå –£–¥–∞–ª–∏—Ç—å –∏–∑ –æ—á–µ—Ä–µ–¥–∏</button>
                <button class="btn btn-warning" onclick="addDemoUsers()">üé™ –î–æ–±–∞–≤–∏—Ç—å 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö</button>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications"></div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const REACTION_EMOJI = '‚úÖ';
        
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let pickingEnabled = true;
        let pickQueue = [];

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã...');
            initializeApp();
        });

        function initializeApp() {
            loadData();
            initializeMap();
            updateDisplay();
            setupEventListeners();
            updateLastAction('–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ –±–æ—Ç–∞
            setTimeout(showBotCode, 1000);
        }


// ==================== WEB SOCKET –ö–õ–ò–ï–ù–¢ ====================
let websocket = null;
let reconnectAttempts = 0;
const maxReconnectAttempts = 5;

function setupWebSocket() {
    try {
        console.log('üîó –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É...');
        websocket = new WebSocket('ws://localhost:8080');
        
        websocket.onopen = function(event) {
            console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É');
            showNotification('üü¢ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
            reconnectAttempts = 0;
            updateLastAction('WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
        };
        
        websocket.onmessage = function(event) {
            try {
                const data = JSON.parse(event.data);
                console.log('üì• –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ WebSocket:', data);
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π
                if (data.type === 'DISCORD_EVENT') {
                    handleDiscordEvent(data.data);
                } else if (data.type === 'SYSTEM') {
                    console.log('üîß –°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:', data.message);
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
            }
        };
        
        websocket.onclose = function(event) {
            console.log('üîå WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
            showNotification('üî¥ WebSocket –æ—Ç–∫–ª—é—á–µ–Ω', 'error');
            
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
            if (reconnectAttempts < maxReconnectAttempts) {
                reconnectAttempts++;
                const delay = Math.min(1000 * reconnectAttempts, 10000); // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
                console.log(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ${reconnectAttempts}/${maxReconnectAttempts} —á–µ—Ä–µ–∑ ${delay}ms`);
                
                setTimeout(() => {
                    setupWebSocket();
                }, delay);
            } else {
                console.log('‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
                showNotification('‚ùå WebSocket: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ', 'error');
            }
        };
        
        websocket.onerror = function(error) {
            console.error('‚ùå WebSocket –æ—à–∏–±–∫–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ WebSocket', 'error');
        };
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:', error);
    }
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ WebSocket
function sendWebSocketMessage(data) {
    if (websocket && websocket.readyState === WebSocket.OPEN) {
        websocket.send(JSON.stringify(data));
        return true;
    } else {
        console.log('‚ùå WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã');
        return false;
    }
}

// –û–±–Ω–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏—é initializeApp()
function initializeApp() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
    loadData();
    initializeMap();
    updateDisplay();
    setupWebSocket(); // ‚Üê –í–ê–ñ–ù–û: –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WebSocket
    setupEventListeners();
    updateLastAction('–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å WebSocket –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
    setInterval(() => {
        const statusElement = document.getElementById('websocketStatus');
        if (statusElement) {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                statusElement.textContent = 'üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω';
                statusElement.style.color = '#57F287';
            } else {
                statusElement.textContent = 'üî¥ –û—Ç–∫–ª—é—á–µ–Ω';
                statusElement.style.color = '#ED4245';
            }
        }
    }, 10000);
}
        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

        function loadData() {
            try {
                const savedPicking = localStorage.getItem('pickingEnabled');
                const savedQueue = localStorage.getItem('pickQueue');

                pickingEnabled = savedPicking !== null ? savedPicking === 'true' : true;
                pickQueue = savedQueue ? JSON.parse(savedQueue) : [];
                console.log('üìÇ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', pickQueue.length, '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –æ—á–µ—Ä–µ–¥–∏');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                pickQueue = [];
            }
        }

        function saveData() {
            try {
                localStorage.setItem('pickingEnabled', pickingEnabled);
                localStorage.setItem('pickQueue', JSON.stringify(pickQueue));
                updateDisplay();
                console.log('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        function initializeMap() {
            const map = document.getElementById('map');
            map.innerHTML = '';
            
            for (let i = 1; i <= 17; i++) {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.id = `slot-${i}`;
                slot.innerHTML = `
                    <div class="slot-number">${i}</div>
                    <div class="slot-username" id="slot-username-${i}">–°–≤–æ–±–æ–¥–Ω–æ</div>
                `;
                map.appendChild(slot);
            }
            console.log('üó∫Ô∏è –ö–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞: 17 —Å–ª–æ—Ç–æ–≤');
        }

        function updateDisplay() {
            updateSystemStatus();
            updateMapSlots();
            updateParticipantsList();
        }

        function updateSystemStatus() {
            const statusElement = document.getElementById('systemStatus');
            const totalPicksElement = document.getElementById('totalPicks');
            
            if (pickingEnabled) {
                statusElement.textContent = '‚úÖ –í–∫–ª—é—á–µ–Ω–∞';
                statusElement.style.color = '#57F287';
            } else {
                statusElement.textContent = '‚ùå –í—ã–∫–ª—é—á–µ–Ω–∞';
                statusElement.style.color = '#ED4245';
            }
            
            totalPicksElement.textContent = `${pickQueue.length}/17`;
        }

        function updateMapSlots() {
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å–ª–æ—Ç—ã
            for (let i = 1; i <= 17; i++) {
                const slot = document.getElementById(`slot-${i}`);
                const slotUsername = document.getElementById(`slot-username-${i}`);
                
                if (slot && slotUsername) {
                    slot.classList.remove('occupied');
                    slotUsername.textContent = '–°–≤–æ–±–æ–¥–Ω–æ';
                    slotUsername.style.color = '#666';
                }
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ª–æ—Ç—ã –ø–æ –ø–æ—Ä—è–¥–∫—É –æ—á–µ—Ä–µ–¥–∏
            pickQueue.forEach((pick, index) => {
                const slotNumber = index + 1;
                if (slotNumber <= 17) {
                    const slot = document.getElementById(`slot-${slotNumber}`);
                    const slotUsername = document.getElementById(`slot-username-${slotNumber}`);
                    
                    if (slot && slotUsername) {
                        slot.classList.add('occupied');
                        slotUsername.textContent = pick.nickname;
                        slotUsername.style.color = '#333';
                    }
                }
            });
        }

        function updateParticipantsList() {
            const queueList = document.getElementById('participantsQueue');
            
            if (!queueList) return;
            
            if (pickQueue.length === 0) {
                queueList.innerHTML = '<li>–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞</li>';
                return;
            }
            
            queueList.innerHTML = '';
            pickQueue.forEach((pick, index) => {
                const li = document.createElement('li');
                const time = new Date(pick.timestamp).toLocaleTimeString();
                li.textContent = `${index + 1}. ${pick.nickname} (${time})`;
                queueList.appendChild(li);
            });
        }

        function updateLastAction(action) {
            const lastActionElement = document.getElementById('lastAction');
            if (lastActionElement) {
                lastActionElement.textContent = action;
            }
        }

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–ß–ï–†–ï–î–¨–Æ ====================

        function addUserToQueue(username) {
            if (!username || username.trim() === '') {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!', 'error');
                return false;
            }

            username = username.trim();

            if (!pickingEnabled) {
                console.log('–ó–∞–ø–∏—Å—å –∑–∞–∫—Ä—ã—Ç–∞, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º:', username);
                showNotification('‚ùå –ó–∞–ø–∏—Å—å –∑–∞–∫—Ä—ã—Ç–∞!', 'error');
                return false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø–∏—Å–∞–Ω –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const userAlreadyInQueue = pickQueue.find(pick => pick.nickname === username);
            if (userAlreadyInQueue) {
                console.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} —É–∂–µ –≤ –æ—á–µ—Ä–µ–¥–∏`);
                showNotification(`‚ùå ${username} —É–∂–µ –≤ –æ—á–µ—Ä–µ–¥–∏!`, 'error');
                return false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ª–∏ –≤—Å–µ —Å–ª–æ—Ç—ã
            if (pickQueue.length >= 17) {
                console.log('–í—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã:', username);
                showNotification(`‚ùå ${username} –Ω–µ —Å–º–æ–≥ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è - –≤—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã!`, 'error');
                return false;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
            const queueNumber = pickQueue.length + 1;
            const pickData = {
                nickname: username,
                queueNumber: queueNumber,
                timestamp: new Date(),
                source: 'discord'
            };

            pickQueue.push(pickData);
            saveData();
            
            const actionText = `‚úÖ ${username} –∑–∞–ø–∏—Å–∞–ª—Å—è –≤ –æ—á–µ—Ä–µ–¥—å (–ø–æ–∑–∏—Ü–∏—è ${queueNumber})`;
            showNotification(actionText, 'success');
            updateLastAction(actionText);
            console.log(actionText);
            return true;
        }

        function removeUserFromQueue(username) {
            if (!username || username.trim() === '') {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!', 'error');
                return false;
            }

            username = username.trim();

            const userIndex = pickQueue.findIndex(pick => pick.nickname === username);

            if (userIndex !== -1) {
                const removedUser = pickQueue[userIndex];
                pickQueue.splice(userIndex, 1);
                
                // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                pickQueue.forEach((pick, index) => {
                    pick.queueNumber = index + 1;
                });
                
                saveData();
                
                const actionText = `‚ùå ${username} –≤—ã—à–µ–ª –∏–∑ –æ—á–µ—Ä–µ–¥–∏`;
                showNotification(actionText, 'error');
                updateLastAction(actionText);
                console.log(actionText);
                return true;
            } else {
                showNotification(`‚ùå ${username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—á–µ—Ä–µ–¥–∏!`, 'error');
                return false;
            }
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø ====================

        function togglePicking(enabled) {
            pickingEnabled = enabled;
            saveData();
            const action = enabled ? '–ó–∞–ø–∏—Å—å –æ—Ç–∫—Ä—ã—Ç–∞' : '–ó–∞–ø–∏—Å—å –∑–∞–∫—Ä—ã—Ç–∞';
            showNotification(action, enabled ? 'success' : 'error');
            updateLastAction(action);
        }

        function resetPicks() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é –æ—á–µ—Ä–µ–¥—å?')) {
                pickQueue = [];
                saveData();
                showNotification('–û—á–µ—Ä–µ–¥—å —Å–±—Ä–æ—à–µ–Ω–∞', 'info');
                updateLastAction('–û—á–µ—Ä–µ–¥—å —Å–±—Ä–æ—à–µ–Ω–∞');
            }
        }

        // ==================== –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï ====================

        function addUserManual() {
            const usernameInput = document.getElementById('testUsername');
            const username = usernameInput ? usernameInput.value : 'TestUser';
            addUserToQueue(username);
        }

        function removeUserManual() {
            const usernameInput = document.getElementById('testUsername');
            const username = usernameInput ? usernameInput.value : 'TestUser';
            removeUserFromQueue(username);
        }

        function addDemoUsers() {
            const demoUsers = [
                'akkawfdkosdiwkekdsiskfas',
                'User_–ê–ª–µ–∫—Å–µ–π',
                'User_–ú–∞—Ä–∏—è', 
                'User_–î–º–∏—Ç—Ä–∏–π',
                'User_–ê–Ω–Ω–∞'
            ];
            
            let added = 0;
            demoUsers.forEach((user, index) => {
                setTimeout(() => {
                    if (addUserToQueue(user)) {
                        added++;
                    }
                }, index * 500);
            });
            
            setTimeout(() => {
                showNotification(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${added} —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`, 'success');
            }, demoUsers.length * 500 + 500);
        }

        function testManualAdd() {
            addUserToQueue('akkawfdkosdiwkekdsiskfas');
        }

        // ==================== DISCORD BOT CODE ====================

        function showBotCode() {
            const botCode = `const { Client, GatewayIntentBits, Partials } = require('discord.js');

const client = new Client({
    intents: [
        GatewayIntentBits.Guilds,
        GatewayIntentBits.GuildMessages,
        GatewayIntentBits.GuildMessageReactions,
        GatewayIntentBits.MessageContent,
    ],
    partials: [Partials.Message, Partials.Channel, Partials.Reaction]
});

// üîß –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø - –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –ó–ù–ê–ß–ï–ù–ò–Ø!
const CONFIG = {
    TOKEN: 'YOUR_BOT_TOKEN_HERE', // –í–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ Discord Developer Portal
    TARGET_CHANNEL_ID: 'YOUR_CHANNEL_ID' // ID –∫–∞–Ω–∞–ª–∞ –≥–¥–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
};

let reactionMessageId = null;

client.on('ready', () => {
    console.log('üéâ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω: ' + client.user.tag);
    createReactionMessage();
});

// –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–µ–∞–∫—Ü–∏–π
async function createReactionMessage() {
    try {
        const channel = await client.channels.fetch(CONFIG.TARGET_CHANNEL_ID);
        const message = await channel.send(\`üéØ **–°–ò–°–¢–ï–ú–ê –ó–ê–ü–ò–°–ò –í –°–õ–û–¢–´**

–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ä–µ–∞–∫—Ü–∏—é ‚úÖ —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –æ—á–µ—Ä–µ–¥—å

‚Ä¢ –ù–∞–∂–º–∏—Ç–µ ‚úÖ - –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç–µ—Å—å –≤ –æ—á–µ—Ä–µ–¥—å
‚Ä¢ –°–ª–æ—Ç—ã –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É –Ω–∞–∂–∞—Ç–∏—è
‚Ä¢ –£–±–µ—Ä–∏—Ç–µ —Ä–µ–∞–∫—Ü–∏—é - –≤—ã—Ö–æ–¥–∏—Ç–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞
**–°–ª–æ—Ç–æ–≤:** 17
        \`);

        reactionMessageId = message.id;
        await message.react('‚úÖ');
        console.log('üìù –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ: ' + message.id);
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∞–∫—Ü–∏–∏
client.on('messageReactionAdd', async (reaction, user) => {
    try {
        if (user.bot) return;
        if (reaction.partial) await reaction.fetch();
        if (reaction.message.id !== reactionMessageId) return;
        if (reaction.emoji.name !== '‚úÖ') return;

        console.log('‚úÖ ' + user.username + ' –∑–∞–ø–∏—Å–∞–ª—Å—è –≤ –æ—á–µ—Ä–µ–¥—å');
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–∞–π—Ç
        await sendToWebsite(user.username, 'add');
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏
client.on('messageReactionRemove', async (reaction, user) => {
    try {
        if (user.bot) return;
        if (reaction.partial) await reaction.fetch();
        if (reaction.message.id !== reactionMessageId) return;
        if (reaction.emoji.name !== '‚úÖ') return;

        console.log('‚ùå ' + user.username + ' –≤—ã—à–µ–ª –∏–∑ –æ—á–µ—Ä–µ–¥–∏');
        await sendToWebsite(user.username, 'remove');
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
    }
});

// üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–∞–π—Ç
async function sendToWebsite(username, action) {
    try {
        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        const data = {
            username: username,
            action: action, // 'add' –∏–ª–∏ 'remove'
            timestamp: new Date().toISOString()
        };

        console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:', data);

        // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
        console.log('üîó –î–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–∞–π—Ç–∞:');
        console.log('handleDiscordEvent(' + JSON.stringify(data) + ')');
        
    } catch (error) {
        console.log('üåê –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error.message);
    }
}

client.login(CONFIG.TOKEN);`;

            const botCodeElement = document.getElementById('botCode');
            const botCodeSection = document.getElementById('botCodeSection');
            
            if (botCodeElement && botCodeSection) {
                botCodeElement.value = botCode;
                botCodeSection.style.display = 'block';
                showNotification('–ö–æ–¥ –±–æ—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
            }
        }

        function copyBotCode() {
            const codeTextarea = document.getElementById('botCode');
            if (codeTextarea) {
                codeTextarea.select();
                document.execCommand('copy');
                showNotification('–ö–æ–¥ –±–æ—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success');
            }
        }

        function downloadBotCode() {
            const codeTextarea = document.getElementById('botCode');
            if (codeTextarea) {
                const code = codeTextarea.value;
                const blob = new Blob([code], { type: 'text/javascript' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'discord-bot.js';
                a.click();
                URL.revokeObjectURL(url);
                showNotification('–§–∞–π–ª bot.js —Å–∫–∞—á–∞–Ω!', 'success');
            }
        }

        // ==================== –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° DISCORD ====================

        function setupEventListeners() {
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–µ–º–∞ —Å–æ–±—ã—Ç–∏–π –æ—Ç Discord –±–æ—Ç–∞
            window.handleDiscordEvent = function(eventData) {
                console.log('üì• –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ –æ—Ç Discord:', eventData);
                const { username, action } = eventData;
                
                if (action === 'add') {
                    addUserToQueue(username);
                } else if (action === 'remove') {
                    removeUserFromQueue(username);
                }
            };

            console.log('üîß –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
        }

        // ==================== –£–¢–ò–õ–ò–¢–´ ====================

        function exportData() {
            const data = {
                pickingEnabled: pickingEnabled,
                pickQueue: pickQueue,
                exportTime: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `slot-pick-${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            URL.revokeObjectURL(url);
            showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }

        function showNotification(message, type) {
            const notifications = document.getElementById('notifications');
            if (!notifications) return;

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            notifications.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        // ==================== –ì–û–¢–û–í–´–ï –¢–ï–°–¢–´ ====================

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.addUserToQueue = addUserToQueue;
        window.removeUserFromQueue = removeUserFromQueue;
        window.handleDiscordEvent = window.handleDiscordEvent;

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(() => {
            if (pickQueue.length === 0) {
                showNotification('üéØ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞! –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å" –¥–ª—è —Ç–µ—Å—Ç–∞', 'info');
            }
        }, 2000);

        console.log('‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ!');
    </script>
</body>
</html>